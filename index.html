<style>
  * {
    font-family:'Courier New', Courier, monospace;    
    font-size:120pt;
    text-align:center;
    color:lightskyblue;
  }
body {
  background:black;
  padding:5px;
}

.timerall {
    
    background:black;
    font-size:140pt;    
    margin:auto;
    margin-left:auto;
    margin-right:auto;
    width:90vw;
    height:35vh;
    outline:1px solid blue;
}

</style>
<html>
    <head>
        <link rel="manifest" href="manifest.json" />
        <script src = "serviceworker.js"></script>
        <script type="module">
                    
                let initial_count_time=5;
                let count_time = initial_count_time;                
                let counter_state = false;
                document.count_down_interval =false; 
                
                let wakeLock = null;

                // create an async function to request a wake lock
                try {
                  const wakeLock = await navigator.wakeLock.request("screen");
                  
                } catch (err) {
                  console.log(err);
                }

                function toggle_timer(){
                  if(!counter_state){    
                    initial_count_time = document.getElementById("count_time").value                    
                      document.getElementById("count_time").disabled=true;
                      document.getElementById("toggle").value = "reset"
                      initial_count_time = document.getElementById("count_time").value;
                      count_time=initial_count_time;
                      document.count_down_interval = setInterval(
                      function interval(){
                          count_down();
                      }, 1000);  
                  }else{
                    document.getElementById("count_time").value=initial_count_time;
                    document.getElementById("count_time").disabled=false;
                      document.getElementById("toggle").value = "start";
                      clearInterval(document.count_down_interval);    
                  }  
                  counter_state = !counter_state
                }
                
                function count_down(){
                if(!counter_state){    
                }else{
                    count_time = document.getElementById("count_time").value;  
                    if(count_time<=0){        
                        beep_thrice();
                        count_time = initial_count_time;
                        document.getElementById("count_time").value=count_time;
                    }else{
                    count_time -=1;
                    document.getElementById("count_time").value=count_time;
                    }
                }
                }
                function beep_thrice(){
                  setTimeout(() => {
                    beep(100,60,100);   
                  }, 100);
                  setTimeout(() => {
                    beep(200,300,100);
                  }, 200);
                  setTimeout(() => {
                    beep(300,600, 100);  
                  }, 300);
                }
                function beep(w,x,y){
                let audio_context = new AudioContext()  
                console.log("Gain:"+w, "Hz:"+x, "ms:"+y)
                let v = audio_context.createOscillator()
                let u = audio_context.createGain()
                v.connect(u)
                v.frequency.value = x
                v.type = "square"
                u.connect(audio_context.destination)
                u.gain.value = w * 0.01
                v.start(audio_context.currentTime)
                v.stop(audio_context.currentTime + y *0.001)
                }
                      

                window.addEventListener('load', () => {
                  registerSW();
                });
            
                // Register the Service Worker
                async function registerSW() {
                  if ('serviceWorker' in navigator) {
                    try {
                      await navigator
                            .serviceWorker
                            .register('serviceworker.js');
                    }
                    catch (e) {
                      console.log('SW registration failed');
                    }
                  }
                }

        window.toggle_timer = toggle_timer
        var input = document.getElementById('myInput');

        window.addEventListener('keypress', function(event) {
          if (event.key === 'Enter') {
            window.toggle_timer();
          }
        });
        </script>    
        <title>Simple Interval Timer</title>
    </head>
<body >
    <div id="timerdiv" >
        <center>                                  
          <input id="toggle" type="button" onclick="window.toggle_timer()" class="timerall" value="start">
          <label style="outline:0px" for="count_time" class="timerall">interval</label>          
          <input  id="count_time" type="number" oninput="this.value = Math.round(this.value);" value="5" min="0" max="3600" class="timerall" />  
          <input enterkeyhint="window.toggle_timer()" style="display:none;" />
        </center>
      </div>
</body>
</html>